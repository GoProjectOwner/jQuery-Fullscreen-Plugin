/**
 * jQuery Fullscreen
 *
 * @author Darcy Clarke
 * @version 1.0
 *
 * Copyright (c) 2012 Darcy Clarke
 * Dual licensed under the MIT and GPL licenses.
 *
 * ADDS: 
 *
 * - $.support.fullscreen (boolean)
 *
 * - :fullscreen pseudo selector & filter (.is .find .filter)
 *
 * - $(el).on("fullscreenchange", fn)
 * - $(el).trigger("requestFullScreen", fn) or $(el).requestFullScreen(fn)
 * - $(el).trigger("cancelFullScreen", fn) or $(el).cancelFullScreen(fn)
 *
 * USES:
 *
 * - :-webkit-full-screen and :-moz-fullscreen (no fallbacks)
 * 
 * - webkit/moz fullscreenchange
 * - webkit/moz Cancel/Request FullScreen 
 * - W3C fullscreenchange 
 * - W3C Exit/Request FullScreen 
 * 
 * FALLBACKS:
 *
 * - Utilizes fullscreen popups with load/unload events to mimic Cancel/Request Fullscreen events
 * - Trigger fullscreenchange on load/unload events
 * - To note: You must turn on fallback support 
 * 
 * Example: 
 * $.extend({ $.fullscreen.settings, { fallback : true, window_url : 'http://google.com' });
 *
 */

(function(e){var t=e.fs=e.fullscreen={};t.settings={timeout:10,loaded:false,fallback:false,window_handler:window,window_name:"fullscreen",window_url:"",window_settings:{height:window.screen.height,width:window.screen.width,directories:0,location:0,menubar:0,resizable:0,status:0,toolbar:0,scrollbars:0},callback:function(n){if(!t.settings.loaded){var r=this,i=e.support.fullscreen?t.fullscreenchange:"load unload";t.settings.loaded=true;n.call(r);setTimeout(function(){e(r).on(i,function(){if(t.settings.loaded)t.settings.loaded=false})},t.settings.timeout)}}};t.el=document.createElement("div");t.selectors="full-screen";t.prefixes="-webkit- -moz- -o- -ms- -khtml- ".split(" ");t.domPrefixes="Webkit Moz O ms Khtml ".split(" "),t.events={change:"fullscreenchange".split(" "),request:"requestFullScreen RequestFullScreen".split(" "),cancel:"cancelFullScreen CancelFullScreen exitFullscreen".split(" ")};t.isEventSupported=function(e,t){var n=e in t;if(!n){t.setAttribute(e,"return;");n=typeof t[e]=="function"}return n};t.test=function(e,t,n){return function(){for(i in e){var r=e[i].toLowerCase();for(x in t){var s=r+t[x];if(n(s))return s}}return false}()};e.extend(e.support,{fullscreen:!!function(){return t.test(t.domPrefixes,t.events.cancel,function(e){return document[e]})}()});if(e.support.fullscreen){t.fullscreenchange=t.test(t.domPrefixes,t.events.change,function(e){return t.isEventSupported("on"+e,t.el)});t.RequestFullScreen=t.test(t.domPrefixes,t.events.request,function(e){return t.isEventSupported(e,t.el)});t.cancelFullScreen=t.test(t.domPrefixes,t.events.cancel,function(e){return document[e]});e.extend(e.expr[":"],{fullscreen:function(n){return e.fs.test(t.prefixes,t.selectors,function(t){return e(n).is(t)})}})}e.event.special.fullscreenchange={setup:function(){var n=e.support.fullscreen?this:t.window_handler,r=e.support.fullscreen?t.fullscreenchange:"load unload";e(n).on(r,e.event.special.fullscreenchange.handler)},teardown:function(){var n=e.support.fullscreen?this:t.window_handler,r=e.support.fullscreen?t.fullscreenchange:"load unload";e(n).off(r,e.event.special.fullscreenchange.handler)},handler:function(e){return true}};e.fn.requestFullScreen=function(n){n=typeof n!="function"?function(){}:n;return this.each(function(r,i){if(t.settings.loaded){e(i).cancelFullScreen()}else{if(e.support.fullscreen){this[t.RequestFullScreen]();t.settings.callback.apply(i,[n])}else{if(t.settings.fallback){if(t.settings.window_handler&&t.settings.window_handler!=window)t.settings.window_handler.moveTo(0,0);t.window_handler=window.open(t.settings.window_url,t.settings.window_name,e.param(t.settings.window_settings).replace("&",","),false);t.window_handler.onload=function(){t.settings.callback.apply(t.window_handler,[n])};t.window_handler.onreadystatechange=function(){t.settings.callback.apply(t.window_handler,[n])};setTimeout(function(){t.settings.callback.apply(t.window_handler,[n])},t.settings.timeout)}}}})};e.fn.cancelFullScreen=function(n){n=typeof n!="function"?function(){}:n;t.settings.loaded=false;return this.each(function(r,i){if(e.support.fullscreen){document[t.CancelFullScreen]();n()}else{e(this).trigger("fullscreenchange");t.settings.window_handler.close();n()}})}})(jQuery);